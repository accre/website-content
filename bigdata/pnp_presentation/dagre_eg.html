<!DOCTYPE html>
<html>
	<head>
		<title>Dagre</title>
		<meta charset="utf-8">
		<script src="http://d3js.org/d3.v3.min.js"></script>
		<script src="http://cpettitt.github.io/project/dagre/v0.5.1/dagre.js"></script>
		<script src="http://cpettitt.github.io/project/dagre-d3/v0.3.0/dagre-d3.js"></script>
		<style>
		svg {
			overflow: hidden;
		}

		/* This sets the color for "TK" nodes to a light blue green. */
		g.type-TK > rect {
			fill: #00ffd0;
		}

		text {
			font-weight: 300;
			font-family: "Helvetica Neue", Helvetica, Arial, sans-serf;
			font-size: 14px;
		}

		.node rect {
			stroke: #999;
			fill: #fff;
			stroke-width: 1.5px;
		}

		.edgePath path {
			stroke: #333;
			stroke-width: 1.5px;
		}

		</style>
	</head>
	<body>
		<svg width=650 height=680></svg>
		<script>
		// Create the input graph
		var g = new dagreD3.graphlib.Graph()
			.setGraph({})
			.setDefaultEdgeLabel(function() { return {}; });
		
		// Here we"re setting nodeclass, which is used by our custom drawNodes function
		// below.
		g.setNode(00,  { label: "INPUT",       class: "type-TOP" });
		g.setNode(10,  { label: "SPLIT0",      class: "type-S" });
		g.setNode(11,  { label: "SPLIT1",      class: "type-S" });
		g.setNode(12,  { label: "SPLIT2",      class: "type-S" });
		g.setNode(20,  { label: "MAP0",      	 class: "type-S" });
		g.setNode(21,  { label: "MAP1",      	 class: "type-S" });
		g.setNode(22,  { label: "MAP2",      	 class: "type-S" });
		g.setNode(30,  { label: "SHUFFLE0",    class: "type-S" });
		g.setNode(31,  { label: "SHUFFLE1",    class: "type-S" });
		g.setNode(32,  { label: "SHUFFLE2",    class: "type-S" });
		g.setNode(33,  { label: "SHUFFLE3",    class: "type-S" });
    g.setNode(40,  { label: "OUTPUT",      class:	"type-TK" });

		g.nodes().forEach(function(v) {
			var node = g.node(v);
			// Round the corners of the nodes
			node.rx = node.ry = 5;
		});
		
		// Set up edges, no special attributes.
		
    // Split
    g.setEdge(0, 10);
		g.setEdge(0, 11);
		g.setEdge(0, 12);

    // Map
    g.setEdge(10, 20);
		g.setEdge(11, 21);
		g.setEdge(12, 22);
    
    // Shuffle
    g.setEdge(20, 30);
    g.setEdge(20, 31);
		g.setEdge(20, 32);
		
    g.setEdge(21, 30);
		
    g.setEdge(22, 31);
    g.setEdge(22, 33);

    // Reduce 
    g.setEdge(30, 40);
		g.setEdge(31, 40);
		g.setEdge(32, 40);
		g.setEdge(33, 40);
    

		// Create the renderer
		var render = new dagreD3.render();
		
		// Set up an SVG group so that we can translate the final graph.
		var svg = d3.select("svg"),
		svgGroup = svg.append("g");
		
		// Run the renderer. This is what draws the final graph.
		render(d3.select("svg g"), g);
		
		// Center the graph
		var xCenterOffset = (svg.attr("width") - g.graph().width) / 2;
		svgGroup.attr("transform", "translate(" + xCenterOffset + ", 20)");
		svg.attr("height", g.graph().height + 40);

		</script>
	</body>
</html>

